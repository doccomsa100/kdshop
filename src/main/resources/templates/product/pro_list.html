<!DOCTYPE html>
<html xmlns:th="http://www.thymeleaf.org"
	xmlns:layout="http://www.ultraq.net.nz/thymeleaf/layout"
	layout:decorate="~{layouts/layout}">


	<th:block layout:fragment="content">
	<div class="row">
		<div class="col text-center mb-3 mt-3">
			<h3 th:utext="${cate_name}"></h3>
		</div>
	</div>
	<div class="row row-cols-1 row-cols-sm-2 row-cols-md-3 g-3">
	  <div class="col" th:each="productDTO : ${produtctList}">
	    <div class="card shadow-sm h-100">
	      <!-- ìƒí’ˆ ì´ë¯¸ì§€ -->
		  <a href="#" th:data-pro_num="${productDTO.pro_num}" class="pro_info">
	      <img th:src="|/product/image_display?dateFolderName=${productDTO.pro_up_folder}&fileName=s_${productDTO.pro_img}|" 
	           class="card-img-top" 
	           alt="ìƒí’ˆ ì´ë¯¸ì§€" 
	           height="255" 
	           style="object-fit: cover;">
		  </a> 
	
	      <div class="card-body d-flex flex-column">
	        <!-- ìƒí’ˆ ì œëª© -->
	        <h5 class="card-title text-truncate fw-bold mb-2" 
	            th:text="${productDTO.pro_name}" 
	            title="ìƒí’ˆ ì œëª©">
	          ìƒí’ˆ ì œëª©
	        </h5>
	
	        <!-- ê°€ê²© -->
	        <p class="mb-1 fs-5 text-primary fw-semibold">
	          <span th:text="${#numbers.formatInteger(productDTO.pro_price, 3, 'COMMA')}"></span> ì›
	        </p>
	
	        <!-- ì¬ê³  ìƒíƒœ -->
	        <p class="mb-3">
	          <span th:if="${productDTO.pro_amount > 0}" 
	                class="badge bg-success">
	            ì¬ê³ : <span th:text="${productDTO.pro_amount}"></span> ê°œ
	          </span>
	          <span th:if="${productDTO.pro_amount == 0}" 
	                class="badge bg-danger">
	            í’ˆì ˆ
	          </span>
	        </p>
	
	        <!-- ìˆ˜ëŸ‰ ì„ íƒ -->
	        <div class="mb-3" th:if="${productDTO.pro_amount > 0}">
	          <label class="form-label small mb-1">êµ¬ë§¤ ìˆ˜ëŸ‰</label>
	          <select class="form-select form-select-sm" name="quantity">
	            <option th:each="i : ${#numbers.sequence(1, productDTO.pro_amount)}"
	                    th:value="${i}"
	                    th:text="${i}">
	            </option>
	          </select>
	        </div>
	
	        <!-- ë²„íŠ¼ ì˜ì—­ -->
	        <div class="mt-auto d-flex justify-content-between gap-2">
	          <!-- ì¥ë°”êµ¬ë‹ˆ -->
	          <input type="hidden" name="pro_num" th:value="${productDTO.pro_num}">
	            <input type="hidden" name="quantity" value="1" class="selected-qty">
	            <button type="button" name="btn_cart_add" th:data-pro_num="${productDTO.pro_num}" class="btn btn-outline-primary btn-sm w-100">ğŸ›’ ì¥ë°”êµ¬ë‹ˆ</button>
	          
	          <!-- êµ¬ë§¤í•˜ê¸° -->
	          	<input type="hidden" name="pro_num" th:value="${productDTO.pro_num}">
	            <input type="hidden" name="quantity" value="1" class="selected-qty">
	            <button type="button" name="btn_buy_add" class="btn btn-success btn-sm w-100" th:data-pro_num="${productDTO.pro_num}">ğŸ’³ êµ¬ë§¤í•˜ê¸°</button>
	          
	        </div>
	      </div>
	    </div>
	  </div>
</div>
	

	


	
	<!--  í˜ì´ì§• ì¶œë ¥ìœ„ì¹˜ -->
	<div class="row mt-5">
		<div class="col">
			<nav aria-label="Page navigation example">
				  <ul class="pagination justify-content-center">
				    <th:block th:if="${pageMaker.prev}">
				    <li class="page-item"><a class="page-link"  th:href="|/product/pro_list${pageMaker.makeSearch(pageMaker.startPage-1)}}&cate_code=${cate_code}|">Previous</a></li>
				    </th:block>
				    
				    <th:block th:each="num : ${#numbers.sequence(pageMaker.startPage, pageMaker.endPage)}">
				    <li class="page-item" th:classappend="${pageMaker.cri.page == num ? 'active' : ''}"><a class="page-link" th:href="|/product/pro_list${pageMaker.makeSearch(num)}&cate_code=${cate_code}|" th:text="${num}"></a></li>
				    </th:block>
				    
				    <th:block th:if="${pageMaker.next}">
				    <li class="page-item"><a class="page-link" th:href="|/product/pro_list${pageMaker.makeSearch(pageMaker.endPage+1)}&cate_code=${cate_code}|">Next</a></li>
				    </th:block>
				  </ul>
				</nav>
		</div>
	</div>
	
	</th:block>
	
	<th:block layout:fragment="script2">
		<script th:inline="javascript">
			$(document).ready(function() {

				// ì¥ë°”êµ¬ë‹ˆë²„íŠ¼ í´ë¦­ì´ë²¤íŠ¸ ì„¤ì •  name="btn_cart_add"
				$("button[name='btn_cart_add']").on("click", function() {
					let pro_num = $(this).data("pro_num");

					// í˜„ì¬ ì„ íƒí•œ ì¥ë°”êµ¬ë‹ˆë²„íŠ¼ íƒœê·¸$(this) ì—ì„œ ì¥ë°”êµ¬ë‹ˆë²„íŠ¼íƒœê·¸ì™€ ìˆ˜ëŸ‰íƒœê·¸ë¥¼ 
					// ê°ì‹¸ëŠ” ë¶€ëª¨íƒœê·¸ div.cardë¡œ ìœ„ì¹˜ë¥¼ ì´ë™í•˜ì—¬
					// find()ë©”ì„œë“œë¡œ ìˆ˜ëŸ‰íƒœê·¸ë¥¼ ì°¾ì•„, í˜„ì¬ ìˆ˜ëŸ‰ê°’ì„ ì½ì–´ì˜¨ë‹¤.
					let cart_amount = $(this).parents("div.card").find("select[name='quantity']").val();

					// console.log("ìƒí’ˆì½”ë“œ", pro_num);
					// console.log("ìˆ˜ëŸ‰", cart_amount);

					$.ajax({
						url: '/cart/cart_add',
						type: 'post',
						data: {pro_num: pro_num, cart_amount: cart_amount},
						dataType: 'text',
						success: function(data) {
							if(data == "success") {
								alert("ì¥ë°”êµ¬ë‹ˆì— ë“±ë¡ë¨");
								if(confirm("ì¥ë°”êµ¬ë‹ˆë¡œ ì´ë™í•˜ê² ìŠµë‹ˆê¹Œ?")) {
									location.href = "/cart/cart_list";
								}
							}
						}
					});
				});


				// ìƒí’ˆ ì´ë¯¸ì§€ í´ë¦­.  <a href="#" class="pro_info">ì´ë¯¸ì§€</a>
				$("a.pro_info").on("click", function(e) {
					e.preventDefault();
					let pro_num = $(this).data("pro_num");
					let cate_name =  encodeURIComponent([[${cate_name}]]); // ë§¨íˆ¬ë§¨&í›„ë“œí‹°.   & ê°€ êµ¬ë¶„ìë¡œ ì‚¬ìš©ë˜ê¸°ë•Œë¬¸ì— ë°ì´í„°ì— í¬í•¨ë˜ì–´ ìˆìœ¼ë©´ ì—ëŸ¬ë°œìƒ

					location.href = `/product/pro_detail?pro_num=${pro_num}&cate_name=${cate_name}`;


				});

			}); // ready-end envent


			// ìë°”ìŠ¤í¬ë¦½íŠ¸ ë¬¸ë²•ìœ¼ë¡œ êµ¬ë§¤ë²„íŠ¼ í´ë¦­ì´ë²¤íŠ¸ ë“±ë¡.  <button name="btn_buy_add" data-pro_num="100">
			document.querySelector("button[name='btn_buy_add']").addEventListener("click", function() {
				let pro_num = this.getAttribute("data-pro_num");
				// ì„ íƒí•œ ë²„íŠ¼ì—ì„œ ê°€ì¥ ê°€ê¹Œìš´ ì¡°ìƒ(ë¶€ëª¨í¬í•¨)ì¤‘ì— div.card-body ì„ íƒìë¥¼ ê°€ì§„ íƒœê·¸ë¥¼ ì°¾ê³ , ê·¸ ë°‘ìœ¼ë¡œ input[name='cart_amount'] íƒœê·¸ë¥¼ ì°¾ì•„ ê°’ì„ ì½ì–´ì˜¨ë‹¤.
				let cart_amount = this.closest("div.card-body").querySelector("select[name='quantity']").value;

				let url = `/order/order_info?pro_num=${pro_num}&cart_amount=${cart_amount}&type=buy`;
				location.href = url;
			});

		</script>
	
	</th:block>
	
	
	
	
	
	
	
</html>